
import React, { useState, useEffect, useRef } from 'react';  
import {   
  Send, Bot, User, Rocket, Target, PenTool,   
  BarChart3, Presentation, Globe, Loader2, Sparkles   
} from 'lucide-react';  
  
const apiKey = ""; // Environment handles this  
  
const App = () => {  
  const [language, setLanguage] = useState('en');   
  const [messages, setMessages] = useState([]);  
  const [input, setInput] = useState('');  
  const [isLoading, setIsLoading] = useState(false);  
  const [activeCategory, setActiveCategory] = useState('General');  
  const scrollRef = useRef(null);  
  
  const translations = {  
    en: {  
      title: "Ahyan Mentor AI",  
      status: "Expert Startup Partner",  
      welcome: "Assalamu Alaikum! I am Ahyan Mentor AI. I am your dedicated expert for starting and growing your business. Whether it's marketing, operations, or strategy, I am here to help you succeed. \n\nHow can I help you build your dream business today?",  
      placeholder: "Ask Ahyan about your business...",  
      areas: "Expertise Domains",  
      tipTitle: "Ahyan's Advice",  
      tipText: "Consistency is the key to business success. Focus on solving a real problem for your customers.",  
      footer: "Ahyan Mentor AI • Unlimited Expert Guidance",  
      thinking: "Ahyan is thinking"  
    },  
    bn: {  
      title: "আয়ান মেন্টর এআই",  
      status: "এক্সপার্ট স্টার্টআপ পার্টনার",  
      welcome: "আসসালামু আলাইকুম! আমি আয়ান মেন্টর এআই। আপনার ব্যবসা শুরু এবং বড় করার জন্য আমি আপনার নিবেদিত বিশেষজ্ঞ। মার্কেটিং, কন্টেন্ট স্ট্র্যাটেজি বা ফিন্যান্সিয়াল প্ল্যানিং—যাই হোক না কেন, আমি আপনাকে সাহায্য করতে প্রস্তুত। \n\nআজ আপনার স্বপ্নের ব্যবসা নিয়ে আমরা কী আলোচনা করতে পারি?",  
      placeholder: "ব্যবসায়িক পরামর্শের জন্য জিজ্ঞাসা করুন...",  
      areas: "বিশেষজ্ঞ বিভাগ",  
      tipTitle: "আয়ানের পরামর্শ",  
      tipText: "ব্যবসায় সফলতার মূল চাবিকাঠি হলো ধৈর্য ও সঠিক পরিকল্পনা। আজই আপনার প্রথম পদক্ষেপটি নিন।",  
      footer: "আয়ান মেন্টর এআই • উদ্যোক্তাদের জন্য বিশেষজ্ঞ পরামর্শ",  
      thinking: "আয়ান চিন্তা করছে"  
    }  
  };  
  
  const t = translations[language];  
  
  const categories = [  
    { name: 'General', bn: 'সাধারণ', icon: <Rocket size={18} />, color: 'bg-blue-500' },  
    { name: 'Marketing', bn: 'মার্কেটিং', icon: <Target size={18} />, color: 'bg-green-500' },  
    { name: 'Content', bn: 'কন্টেন্ট', icon: <PenTool size={18} />, color: 'bg-purple-500' },  
    { name: 'Finance', bn: 'অর্থায়ন', icon: <BarChart3 size={18} />, color: 'bg-orange-500' },  
    { name: 'Pitching', bn: 'পিচিং', icon: <Presentation size={18} />, color: 'bg-red-500' },  
  ];  
  
  useEffect(() => {  
    setMessages([{  
      role: 'bot',  
      content: t.welcome,  
      timestamp: new Date().toLocaleTimeString(),  
    }]);  
  }, [language]);  
  
  useEffect(() => {  
    scrollRef.current?.scrollTo({ top: scrollRef.current.scrollHeight, behavior: 'smooth' });  
  }, [messages, isLoading]);  
  
  const callGemini = async (userPrompt) => {  
    const systemPrompt = `You are "Ahyan Mentor AI", a professional business mentor.  
      
    BACKGROUND LIMITATION:  
    1. You ONLY provide help regarding Business Management, Marketing, Startups, Sales, Content Strategy, and Professional Development.  
    2. If a user asks something unrelated to business (e.g., entertainment, general school subjects, unrelated science, personal gossip), politely tell them that you are focused on helping them with their business goals and ask them to redirect the question to entrepreneurship.  
    3. Do not be aggressive about this limit, just stay focused on your expertise.  
      
    Target Audience: Beginner entrepreneurs (especially in Bangladesh).  
    Nuances: Understand local platforms like Facebook/Instagram commerce, Bkash/Nagad payments, and local logistics.  
    Language: Reply in ${language === 'en' ? 'English' : 'Bengali'}.`;  
  
    try {  
      const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {  
        method: 'POST',  
        headers: { 'Content-Type': 'application/json' },  
        body: JSON.stringify({  
          contents: [{ parts: [{ text: userPrompt }] }],  
          systemInstruction: { parts: [{ text: systemPrompt }] }  
        })  
      });  
      const data = await response.json();  
      return data.candidates?.[0]?.content?.parts?.[0]?.text || "I'm sorry, I couldn't process that.";  
    } catch (error) {  
      return "Connection error. Please try again.";  
    }  
  };  
  
  const handleSend = async (e) => {  
    e.preventDefault();  
    if (!input.trim() || isLoading) return;  
    const userMsg = input;  
    setMessages(prev => [...prev, { role: 'user', content: userMsg, timestamp: new Date().toLocaleTimeString() }]);  
    setInput('');  
    setIsLoading(true);  
    const aiResponse = await callGemini(userMsg);  
    setMessages(prev => [...prev, { role: 'bot', content: aiResponse, timestamp: new Date().toLocaleTimeString() }]);  
    setIsLoading(false);  
  };  
  
  return (  
    <div className="flex flex-col h-screen bg-slate-50 font-sans text-slate-900 overflow-hidden">  
      {/* Navbar */}  
      <header className="bg-white border-b border-slate-200 px-4 py-4 flex items-center justify-between shadow-sm z-30">  
        <div className="flex items-center gap-3">  
          <div className="bg-indigo-600 p-2 rounded-xl text-white shadow-lg shadow-indigo-100">  
            <Bot size={22} />  
          </div>  
          <div>  
            <h1 className="font-bold text-lg md:text-xl tracking-tight">{t.title}</h1>  
            <p className="text-[10px] md:text-xs text-indigo-500 font-bold uppercase tracking-wider flex items-center gap-1">  
              <span className="w-1.5 h-1.5 bg-indigo-500 rounded-full animate-pulse"></span>  
              {t.status}  
            </p>  
          </div>  
        </div>  
        <div className="bg-slate-100 rounded-full p-1 flex border border-slate-200">  
          {['en', 'bn'].map(lang => (  
            <button   
              key={lang} onClick={() => setLanguage(lang)}  
              className={`px-4 py-1.5 rounded-full text-[10px] md:text-xs font-bold transition-all ${language === lang ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`}  
            >  
              {lang === 'en' ? 'EN' : 'বাংলা'}  
            </button>  
          ))}  
        </div>  
      </header>  
  
      <div className="flex flex-1 overflow-hidden">  
        {/* Sidebar - Desktop */}  
        <aside className="hidden lg:flex w-72 bg-white border-r border-slate-200 flex-col p-6 gap-4">  
          <h3 className="text-[10px] font-black text-slate-400 uppercase tracking-widest px-2">{t.areas}</h3>  
          <div className="space-y-1">  
            {categories.map(cat => (  
              <button   
                key={cat.name} onClick={() => setActiveCategory(cat.name)}  
                className={`w-full flex items-center gap-3 px-4 py-3 rounded-2xl transition-all ${activeCategory === cat.name ? 'bg-indigo-600 text-white shadow-md' : 'hover:bg-slate-50 text-slate-600'}`}  
              >  
                <div className={activeCategory === cat.name ? 'text-white' : 'text-indigo-600'}>{cat.icon}</div>  
                <span className="text-sm font-semibold">{language === 'en' ? cat.name : cat.bn}</span>  
              </button>  
            ))}  
          </div>  
            
          <div className="mt-auto p-5 bg-slate-900 rounded-[2rem] text-white shadow-xl">  
            <div className="flex items-center gap-2 mb-2 text-indigo-400">  
              <Sparkles size={14} />  
              <h4 className="text-[10px] font-bold uppercase tracking-widest">{t.tipTitle}</h4>  
            </div>  
            <p className="text-[11px] leading-relaxed opacity-80 italic">"{t.tipText}"</p>  
          </div>  
        </aside>  
  
        {/* Chat window */}  
        <main className="flex-1 flex flex-col relative bg-slate-50">  
          <div ref={scrollRef} className="flex-1 overflow-y-auto p-4 md:p-8 space-y-8 pb-40">  
            {messages.map((msg, i) => (  
              <div key={i} className={`flex w-full ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>  
                <div className={`flex gap-3 max-w-[92%] md:max-w-[80%] ${msg.role === 'user' ? 'flex-row-reverse' : ''}`}>  
                  <div className={`w-9 h-9 rounded-xl flex items-center justify-center flex-shrink-0 shadow-sm ${msg.role === 'user' ? 'bg-indigo-600 text-white' : 'bg-white border text-indigo-600'}`}>  
                    {msg.role === 'user' ? <User size={18} /> : <Bot size={18} />}  
                  </div>  
                  <div className={`p-4 md:p-5 rounded-[1.5rem] shadow-sm text-[14px] md:text-base leading-relaxed ${msg.role === 'user' ? 'bg-indigo-600 text-white rounded-tr-none' : 'bg-white border border-slate-100 rounded-tl-none text-slate-800'}`}>  
                    {msg.content.split('\n').map((l, j) => <p key={j} className="mb-2 last:mb-0">{l}</p>)}  
                  </div>  
                </div>  
              </div>  
            ))}  
            {isLoading && (  
              <div className="flex gap-3 items-center text-slate-400">  
                <div className="w-9 h-9 bg-white border border-slate-100 rounded-xl flex items-center justify-center animate-pulse"><Bot size={18} className="text-slate-300" /></div>  
                <span className="text-[10px] font-bold uppercase tracking-widest">{t.thinking}...</span>  
              </div>  
            )}  
          </div>  
  
          {/* Fixed Input */}  
          <div className="absolute bottom-0 w-full p-4 md:p-8 bg-gradient-to-t from-slate-50 via-slate-50 to-transparent">  
            <form onSubmit={handleSend} className="max-w-4xl mx-auto flex items-center gap-2 bg-white p-2 md:p-3 rounded-[2rem] border border-slate-200 shadow-2xl focus-within:ring-4 focus-within:ring-indigo-500/10 transition-all">  
              <input   
                value={input} onChange={e => setInput(e.target.value)}  
                placeholder={t.placeholder}  
                className="flex-1 bg-transparent border-none focus:ring-0 px-4 md:px-6 text-sm md:text-base font-medium"  
              />  
              <button   
                type="submit"   
                disabled={!input.trim() || isLoading}  
                className="bg-indigo-600 text-white h-12 w-12 md:h-14 md:w-14 rounded-full flex items-center justify-center hover:bg-indigo-700 disabled:opacity-50 transition-all active:scale-95 shadow-lg shadow-indigo-200"  
              >  
                <Send size={18} />  
              </button>  
            </form>  
            <div className="mt-4 text-center">  
              <p className="text-[10px] text-slate-400 font-bold uppercase tracking-[0.2em]">{t.footer}</p>  
            </div>  
          </div>  
        </main>  
      </div>  
    </div>  
  );  
};  
  
export default App;  
